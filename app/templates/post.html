<!DOCTYPE html>
<html>
<head>
    <title>{{ post.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <style>
      .avatar-circle {
        width: 32px;
        height: 32px;
        background-color: #007bff;
        color: white;
        border-radius: 50%;
        text-align: center;
        line-height: 32px;
        font-weight: bold;
        display: inline-block;
      }
      .initials {
        font-size: 16px;
      }
    </style>
</head>
<body class="bg-light">
    {% include 'navbar.html' %}

    

    <div class="container py-5">
        <h1>{{ post.title }}</h1>

        {% if post.timestamp %}
          <p class="text-muted">{{ post.timestamp.strftime('%B %d, %Y') }}</p>
        {% endif %}


<article class="mt-4">
  {{ rendered_content }}
</article>







{% if "crime" in post.title.lower() %}
  <h5>Monthly Crime Volume</h5>
  <img src="{{ url_for('static', filename='monthly_crime_trends.png') }}" class="img-fluid" alt="Monthly Crime Trends">
{% endif %}


        <!-- Folium Heatmap -->


{% if "heatmap" in post.title.lower() %}
  <div class="mt-4">
    <h5>Interactive Crime Heatmap</h5>
    <iframe src="{{ url_for('static', filename='heatmap.html') }}" width="100%" height="600" style="border:none;" title="UK Crime Heatmap"></iframe>
  </div>
{% endif %}


{% block content %}
  {% if post.plot_html %}
    <div>{{ post.plot_html | safe }}</div>
  {% endif %}
{% endblock %}


{% if post.author_id == current_user.id %}
  <div class="mt-4">
    <a href="{{ url_for('home.edit_post', post_id=post.id) }}" class="btn btn-warning me-2">Edit Post</a>
    <form method="POST" action="{{ url_for('home.delete_post', post_id=post.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this post?');">
      <button type="submit" class="btn btn-danger">Delete Post</button>
    </form>
  </div>
{% endif %}
  

        <!-- Comment Form -->
        <h4 class="mt-5">Leave a Comment</h4>
        <form method="POST" action="{{ url_for('home.add_comment', post_id=post.id) }}">
            <textarea name="content" class="form-control" rows="3" required></textarea>
            <button type="submit" class="btn btn-primary mt-2">Submit Comment</button>
        </form>



        <!-- Post Stats -->
        <div class="mt-3">
            <p>👍 Likes: {{ post.likes }} | 👁️ Views: {{ post.views }}</p>
            <form action="{{ url_for('home.like_post', post_id=post.id) }}" method="POST">
                <button type="submit" class="btn btn-outline-primary">Like</button>
            </form>
        </div>


        <!-- Comments Section -->
        <h5 class="mt-4">Comments ({{ post.comments.count() }})</h5>
        <hr>
<p class="text-muted small">
  {% for emoji in ['❤️', '😂', '👍'] %}
    {{ emoji }} {{ post.reactions | selectattr('emoji', 'equalto', emoji) | list | length }}
  {% endfor %}
</p>

<form method="POST" action="{{ url_for('home.react') }}">
  <input type="hidden" name="post_id" value="{{ post.id }}">
  <button type="submit" name="emoji" value="👍" class="btn btn-sm">👍</button>
  <button type="submit" name="emoji" value="😂" class="btn btn-sm">😂</button>
  <button type="submit" name="emoji" value="❤️" class="btn btn-sm">❤️</button>
</form>

{% for comment in comments %}
 <div class="d-flex align-items-center mb-2">
  <div class="avatar-circle me-2">
    <span class="initials">{{ comment.author.username[0] }}</span>
  </div>
  <div class="text-muted small">
    {{ comment.author.username }} • {{ comment.timestamp.strftime('%Y-%m-%d %H:%M') }}
  </div>
</div>

<div>{{ comment.content | safe }}</div>

{% if comment.author_id == current_user.id %}
  <a href="{{ url_for('home.edit_comment', comment_id=comment.id) }}" class="btn btn-sm btn-outline-secondary mt-2">Edit Comment</a>
{% endif %}

      <div class="mt-2">
        {% for emoji in ['❤️', '😂', '🔥'] %}
          <form method="POST" action="{{ url_for('home.react_to_comment', comment_id=comment.id, emoji=emoji) }}" style="display:inline;">
            <button type="submit" class="btn btn-sm btn-light me-2">{{ emoji }} {{ comment.reactions.filter_by(emoji=emoji).count() }}</button>
          </form>
        {% endfor %}
      </div>

      
</div>
  </div>
{% endfor %}
      {% if current_user.role == 'admin' %}
        <a href="{{ url_for('home.dashboard') }}" class="btn btn-secondary mt-4">Back to Dashboard</a>
      {% endif %}

       
    </div>

  
    <!-- Footer -->
  <footer class="bg-dark text-white text-center py-3 mt-5">
    <p class="mb-0">© {{ current_year }} UK Crime Blog. Built by Hassan.</p>
  </footer>
</body>
</html>